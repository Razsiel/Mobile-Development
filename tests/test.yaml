# First install: "git clone https://github.com/svanoort/pyresttest.git" &
# >> "sudo python setup.py install"
# Quickstart guide: "https://github.com/svanoort/pyresttest/blob/master/quickstart.md"
# Run script: "resttest.py https://www.imready.ml test.yaml"

---
- config:
    - testset: "Quickstart app tests"

# Inloggen username en password als JSON   username=client1  pass=client1
# De enige call waar je dan op kan testen krijg je een Token terug (json object)
# Dus in de header gooi ik de de key maar in het autorization object
# - headers: {Authorization: "$token"}

# LOGIN TEST
- test:
    - group: "Authentication"
    - name: "Login using basic auth"
    - url: "/api/v1/login/"
    - method: 'POST'
    - body: '{"username":"admin", "password":"admin"}'
    - headers: {"Content-Type": "application/json"}
    - expected_status: [200]
    - extract_binds:
        - "authtoken": {"jsonpath_mini": "authtoken"}

  # BLOCK TESTEN
- test:
    - group: "Blocks"
    - name: "Basic blocks smoketest"
    - url: "/api/v1/blocks/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}

- test:
    - group: "Blocks"
    - name: "Test with schema validations"
    - url: {'template': "/api/v1/blocks/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {header: "content-type", comparator: contains, expected: 'application/json'}

- test:
    - group: "Blocks"
    - name: "Make sure blocks are there"
    - url: "/api/v1/blocks/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Blocks"
    - name: "Make sure specific block isnt is there"
    - url: "/api/v1/blocks/9999999/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [404]

- test:
    - group: "Blocks"
    - name: "Create a new block"
    - url: "/api/v1/blocks/"
    - method: "POST"
    - body: '{"name": "Test","description": "Dit is een test","imageURL": "","activities": []}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [201]
    - extract_binds:
        - 'blockId': {header: 'Id'}

- test:
    - group: "Blocks"
    - name: "Get the block just created and check it"
    - url: {'template': "/api/v1/blocks/$blockId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {jsonpath_mini: 'id', comparator: 'str_eq', expected: {template: '$blockId'}}
        - extract_test: {jsonpath_mini: 'id', test: 'exists'}
    - expected_status: [200]

# CLIENT TESTEN
- test:
    - group: "Clients"
    - name: "Basic clients smoketest"
    - url: "/api/v1/clients/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}

- test:
    - group: "Clients"
    - name: "Test with schema validations"
    - url: {'template': "/api/v1/clients/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {header: "content-type", comparator: contains, expected: "application/json"}
    - expected_status: [200]

- test:
    - group: "Clients"
    - name: "Make sure clients are there"
    - url: "/api/v1/clients/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients"
    - name: "Create a new client"
    - url: "/api/v1/clients/"
    - method: "POST"
    - body: '{"username": "clientTest1", "password": "clientTest1"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [201]
    - extract_binds:
        - 'clientId': {header: 'Id'}

- test:
    - group: "Clients"
    - name: "Get the client just created and check it"
    - url: {'template': "/api/v1/clients/$clientId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {jsonpath_mini: 'id', comparator: 'str_eq', expected: {template: '$clientId'}}
        - extract_test: {jsonpath_mini: 'id', test: 'exists'}
    - expected_status: [200]

- test:
    - group: "Clients"
    - name: "Patch the client that is just created"
    - url: {'template': "/api/v1/clients/$clientId/"}
    - method: 'PATCH'
    - body: '[{ "op": "replace", "path": "/password", "value": "clientTest2" }]'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients"
    - name: "PUT client"
    - url: {'template': "/api/v1/clients/$clientId/"}
    - method: "PUT"
    - body: '{"username": "clientTest2", "password": "clientTest2"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]


# DEZE MISSCHIEN PAS DOEN NA HET AANMAKEN VAN EEN NIEUWE FAMILIE?
- test:
    - group: "Clients > family"
    - name: "Post client family"
    - url: {'template': "/api/v1/clients/$clientId/families/"}
    - method: "POST"
    - body: '{"id":"59e7408fa7d93e1428711624"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [201]

- test:
    - group: "Clients > family"
    - name: "Get client families"
    - url: {'template': "/api/v1/clients/$clientId/families/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients > family"
    - name: "Get specific client family"
    - url: {'template': "/api/v1/clients/$clientId/families/59e7408fa7d93e1428711624/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

# DEZE WERKT NOG NIET
# - test:
#     - group: "Clients > family"
#     - name: "PUT specific client family"
#     - url: {'template': "/api/v1/clients/$clientId/families/59e7408fa7d93e1428711624/"}
#     - method: "PUT"
#     - body: '{"id":""}'
#     - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
#     - expected_status: [200]

- test:
    - group: "Clients > family"
    - name: "DELETE specific client family"
    - url: {'template': "/api/v1/clients/$clientId/families/59e7408fa7d93e1428711624/"}
    - method: "DELETE"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [204]


# DEZE MISSCHIEN PAS DOEN NA HET AANMAKEN VAN EEN NIEUWE CAREGIVER?
- test:
    - group: "Clients > caregiver"
    - name: "Post client caregiver"
    - url: {'template': "/api/v1/clients/$clientId/caregivers/"}
    - method: "POST"
    - body: '{"id":"59c8d1ba6f03f4349886526e"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [201]

- test:
    - group: "Clients > caregiver"
    - name: "Get client caregiver"
    - url: {'template': "/api/v1/clients/$clientId/caregivers/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients > caregiver"
    - name: "Get specific client caregiver"
    - url: {'template': "/api/v1/clients/$clientId/caregivers/59c8d1ba6f03f4349886526e/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

# DEZE WERKT NOG NIET > eerst family fixen en dan overnemen
# - test:
#     - group: "Clients > caregiver"
#     - name: "PUT specific client caregiver"
#     - url: {'template': "/api/v1/clients/$clientId/caregiver/59c8d1ba6f03f4349886526e/"}
#     - method: "PUT"
#     - body: '{"id":""}'
#     - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
#     - expected_status: [200]

- test:
    - group: "Clients > caregiver"
    - name: "DELETE specific client caregiver"
    - url: {'template': "/api/v1/clients/$clientId/caregivers/59c8d1ba6f03f4349886526e/"}
    - method: "DELETE"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [204]


- test:
    - group: "Clients > blocks"
    - name: "Post client blocks"
    - url: {'template': "/api/v1/clients/$clientId/blocks/"}
    - method: "POST"
    - body: {'template':'{"id":"$blockId"}'}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - extract_binds:
        - 'clientBlockId': {header: 'Id'}
    - expected_status: [201]

- test:
    - group: "Clients > blocks"
    - name: "Get client blocks"
    - url: {'template': "/api/v1/clients/$clientId/blocks/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients > blocks"
    - name: "Get specific client block"
    - url: {'template': "/api/v1/clients/$clientId/blocks/$clientBlockId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Clients > blocks > activities"
    - name: "Get client block activities"
    - url: {'template': "/api/v1/clients/$clientId/blocks/$clientBlockId/activities"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]


- test:
    - group: "Clients > blocks"
    - name: "DELETE specific client block"
    - url: {'template': "/api/v1/clients/$clientId/blocks/$clientBlockId/"}
    - method: "DELETE"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [204]

- test:
    - group: "Blocks"
    - name: "delete the block that was created"
    - url: {'template': "/api/v1/blocks/$blockId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - method: 'DELETE'

- test:
    - group: "Blocks"
    - name: "check if the block is deleted"
    - url: {'template': "/api/v1/blocks/$blockId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [404]


- test:
    - group: "Clients"
    - name: "Delete the client that is just created"
    - url: {'template': "/api/v1/clients/$clientId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - method: 'DELETE'

- test:
    - group: "Clients"
    - name: "Check if the client is deleted"
    - url: {'template': "/api/v1/clients/$clientId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [404]


# CAREGIVER TESTEN
- test:
    - group: "Caregiver"
    - name: "Basic Caregiver smoketest"
    - url: "/api/v1/caregivers/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}

- test:
    - group: "Caregiver"
    - name: "Test with schema validations"
    - url: {'template': "/api/v1/caregivers/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {header: "content-type", comparator: contains, expected: "application/json"}
    - expected_status: [200]

- test:
    - group: "Caregiver"
    - name: "Make sure caregivers are there"
    - url: "/api/v1/caregivers/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]

- test:
    - group: "Caregiver"
    - name: "Create a new caregiver"
    - url: "/api/v1/caregivers/"
    - method: "POST"
    - body: '{"username": "caregiverTest1", "password": "caregiverTest1"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [201]
    - extract_binds:
        - 'caregiverId': {header: 'Id'}

- test:
    - group: "Caregiver"
    - name: "Get the caregiver just created and check it"
    - url: {'template': "/api/v1/caregivers/$caregiverId/"}
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - validators:
        - compare: {jsonpath_mini: 'id', comparator: 'str_eq', expected: {template: '$caregiverId'}}
        - extract_test: {jsonpath_mini: 'id', test: 'exists'}
    - expected_status: [200]

- test:
    - group: "Caregiver"
    - name: "PUT client"
    - url: {'template': "/api/v1/caregivers/$caregiverId/"}
    - method: "PUT"
    - body: '{"username": "caregiverTest2", "password": "caregiverTest3"}'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [200]



# LOGOUT TEST
- test:
    - group: "Authentication"
    - name: "Logout"
    - url: "/api/v1/logout/"
    - method: 'POST'
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}

- test:
    - group: "Authentication"
    - name: "Check if logout was succesful"
    - url: "/api/v1/blocks/"
    - headers: {template: {"Content-Type": "application/json", "Authorization": "$authtoken"}}
    - expected_status: [401]
